ldc.register("editor",["loader"],function(e){var n,r,t,o,i,d,a,l,u,c,f;return e.loader,n={name:"biography"},(r=new ldLoader({root:".ldld.full"})).on(),t={editor:ld$.find("[ld=editor]",0),viewer:ld$.find("[ld=viewer]",0)},o=CodeMirror(t.editor,{mode:"yaml",lineNumbers:!0,theme:"ayu-mirage",lineWrapping:!0,keyMap:"default",showCursorWhenSelecting:!0,viewportMargin:1/0}),i=t.editor.getBoundingClientRect(),o.setSize(i.width,i.height),o.setValue(""),o.on("change",function(){return f()}),(d=new sharedbWrapper({url:{scheme:window.location.protocol.replace(":",""),domain:window.location.host}})).on("close",function(){return lda.ldcvmgr.toggle("disconnected")}),a=new ldView({root:t.viewer,handler:{"timeline-item":{list:function(){return n.parsedData||[]},handler:function(e){var n,r;return n=e.node,r=e.data,ld$.find(n,"[ld=year]",0).innerText=r.year,ld$.find(n,"[ld=title]",0).innerText=r.title,ld$.find(n,"[ld=content]",0).innerHTML=DOMPurify.sanitize(marked(r.content))}}}}),l=debounce(function(){return n.parsedData=jsyaml.load(n.cur.biography),a.render()}),u=function(e,r){var t,i;if(!r)return t=o.getValue(),i=(n.doc.data||{})[n.name],t!==i?((n.old||(n.old={}))[n.name]=(n.cur||(n.cur={}))[n.name]=i,o.setValue(i||""),l()):void 0},c=function(){return d.get({id:"biography",watch:u}).then(function(e){return n.doc=e,n.old=JSON.parse(JSON.stringify(e.data)),n.cur=JSON.parse(JSON.stringify(e.data)),o.setValue((n.cur||(n.cur={}))[n.name]||""),r.off(),l()}).catch(function(e){return console.log("document open failed: ",e)})},f=function(){var e;if(e=o.getValue(),(n.cur||(n.cur={}))[n.name]!==e)return(n.cur||(n.cur={}))[n.name]=e,n.doc&&n.doc.submitOp(d.json.diff(n.old,n.cur)),(n.old||(n.old={}))[n.name]=e,l()},c()}),ldc.app("editor");
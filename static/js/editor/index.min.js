ldc.register("editor",["loader"],function(e){var n,r,t,o,i,d,a,c,l,u,f;return e.loader,n=new ldView({root:document.body,action:{click:{reconnect:function(e){return e.node,e.evt,t.on(),a.reconnect().then(function(){return debounce(1e3)}).then(function(){return lda.ldcvmgr.toggle("disconnected",!1),t.off()}).then(function(){return u()})}}}}),r={name:"biography"},(t=new ldLoader({root:".ldld.full"})).on(),o={editor:ld$.find("[ld=editor]",0),viewer:ld$.find("[ld=viewer]",0)},i=CodeMirror(o.editor,{mode:"yaml",lineNumbers:!0,theme:"ayu-mirage",lineWrapping:!0,keyMap:"default",showCursorWhenSelecting:!0,viewportMargin:1/0}),d=o.editor.getBoundingClientRect(),i.setSize(d.width,d.height),i.setValue(""),i.on("change",function(){return f()}),(a=new sharedbWrapper({url:{scheme:window.location.protocol.replace(":",""),domain:window.location.host}})).on("close",function(){return lda.ldcvmgr.toggle("disconnected")}),n=new ldView({root:o.viewer,handler:{"timeline-item":{list:function(){return r.parsedData||[]},handler:function(e){var n,r;return n=e.node,r=e.data,ld$.find(n,"[ld=year]",0).innerText=r.year,ld$.find(n,"[ld=title]",0).innerText=r.title,ld$.find(n,"[ld=content]",0).innerHTML=DOMPurify.sanitize(marked(r.content))}}}}),c=debounce(function(){return console.log(r.cur.biography),r.parsedData=jsyaml.load(r.cur.biography),n.render()}),l=function(e,n){var t,o;if(!n)return t=i.getValue(),o=(r.doc.data||{})[r.name],t!==o?((r.old||(r.old={}))[r.name]=(r.cur||(r.cur={}))[r.name]=o,i.setValue(o||""),c()):void 0},u=function(){return a.get({id:"biography",watch:l}).then(function(e){return r.doc=e,r.old=JSON.parse(JSON.stringify(e.data)),r.cur=JSON.parse(JSON.stringify(e.data)),i.setValue((r.cur||(r.cur={}))[r.name]||""),t.off(),c()}).catch(function(e){return console.log("document open failed: ",e)})},f=function(){var e;if(e=i.getValue(),(r.cur||(r.cur={}))[r.name]!==e)return(r.cur||(r.cur={}))[r.name]=e,r.doc&&r.doc.submitOp(a.json.diff(r.old,r.cur)),(r.old||(r.old={}))[r.name]=e,c()},u()}),ldc.app("editor");